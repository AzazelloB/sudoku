(function(){"use strict";const g={easy:38,normal:30,hard:23,expert:17},c=9,I=9;var w=(o=>(o[o.NORMAL_SUDOKU=0]="NORMAL_SUDOKU",o[o.KINGS_MOVE=1]="KINGS_MOVE",o[o.KNIGHTS_MOVE=2]="KNIGHTS_MOVE",o))(w||{});const S=(o,n,r)=>{const e=r%c,t=Math.floor(r/c);for(let a=0;a<c;a++){const i=t*c+a,h=e+a*c;if(i!==r&&o[i]===n||h!==r&&o[h]===n)return!1}const s=Math.floor(t/3)*3,l=Math.floor(e/3)*3,f=s+3,u=l+3;for(let a=s;a<f;a++)for(let i=l;i<u;i++){const h=a*c+i;if(h!==r&&o[h]===n)return!1}return!0},v=(o,n,r)=>{for(let e=-1;e<=1;e++)for(let t=-1;t<=1;t++){const s=r+e*c+t;if(s!==r&&o[s]===n)return!1}return!0},O=(o,n,r)=>{const e=r%c,t=Math.floor(r/c),s=[{col:e-2,row:t-1},{col:e-2,row:t+1},{col:e-1,row:t-2},{col:e-1,row:t+2},{col:e+1,row:t-2},{col:e+1,row:t+2},{col:e+2,row:t-1},{col:e+2,row:t+1}];for(const l of s)if(l.col>=0&&l.col<c&&l.row>=0&&l.row<c){const f=l.row*c+l.col;if(o[f]===n)return!1}return!0},K={[w.NORMAL_SUDOKU]:S,[w.KINGS_MOVE]:v,[w.KNIGHTS_MOVE]:O},M=(o,n,r,e)=>{for(const t of o)if(!K[t](n,r,e))return!1;return!0},V=o=>{for(let n=o.length-1;n>0;n--){const r=Math.floor(Math.random()*(n+1)),e=o[n];o[n]=o[r],o[r]=e}},d=(o,n,r=0)=>{if(r===n.length)return!0;const e=[1,2,3,4,5,6,7,8,9];for(;e.length;){const[t]=e.splice(Math.floor(Math.random()*e.length),1);if(M(o,n,t,r)&&(n[r]=t,d(o,n,r+1)))return!0}return n[r]=null,!1},E=o=>{for(let n=0;n<o.length;n++)if(o[n]===null)return n;return null},N=o=>{let n=0;return function r(e,t=0){if(n++,n>1e5)throw new Error("enough");if(t>1)return t;const s=E(e);if(s!==null)for(let l=1;l<=9;l++)M(o,e,l,s)&&(e[s]=l,t=r(e,t),e[s]=null);else t++;return t}},m=(o,n,r)=>{try{const e=N(r),t=o.slice(),s=[...t.keys()];V(s);const l=t.length-1-g[n];for(let f=0;f<=l;){const u=s.pop(),a=t[u];t[u]=null,e(t.slice())===1?f++:(t[u]=a,s.unshift(u))}return t}catch{return m(o,n,r)}},_=({difficulty:o,rules:n})=>{const r=new Array(c*I).fill(null);d(n,r);const e=m(r,o,n),t=[];for(let s=0;s<r.length;s+=1)t.push({value:null,answer:r[s],revealed:e[s]!==null,corner:[],middle:[],col:s%c,row:Math.floor(s/c),colors:[]});return t};onmessage=({data:{difficulty:o,rules:n}})=>{const r=_({difficulty:o,rules:n});postMessage(r)}})();
