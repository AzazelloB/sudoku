(function(){"use strict";var h=(l=>(l.NORMAL_SUDOKU="normal-sudoku",l.KINGS_MOVE="kings-move",l.KNIGHTS_MOVE="knights-move",l.KILLER_SUDOKU="killer-sudoku",l))(h||{});const C=(l,i,e,n)=>{const o=n%9,t=Math.floor(n/9);for(let r=0;r<9;r++){const c=t*9+r,u=o+r*9;if(c!==n&&i[c]===e||u!==n&&i[u]===e)return!1}const s=Math.floor(t/3)*3,a=Math.floor(o/3)*3,f=s+3,I=a+3;for(let r=s;r<f;r++)for(let c=a;c<I;c++){const u=r*9+c;if(u!==n&&i[u]===e)return!1}return!0},b=(l,i,e,n)=>{for(let o=-1;o<=1;o++)for(let t=-1;t<=1;t++){const s=n+o*9+t;if(s!==n&&i[s]===e)return!1}return!0},O=(l,i,e,n)=>{const o=n%9,t=Math.floor(n/9),s=[{col:o-2,row:t-1},{col:o-2,row:t+1},{col:o-1,row:t-2},{col:o-1,row:t+2},{col:o+1,row:t-2},{col:o+1,row:t+2},{col:o+2,row:t-1},{col:o+2,row:t+1}];for(const a of s)if(a.col>=0&&a.col<9&&a.row>=0&&a.row<9){const f=a.row*9+a.col;if(i[f]===e)return!1}return!0},_=(l,i,e,n)=>{const{cages:o}=l,t=n%9,s=Math.floor(n/9);for(const a of o){if(!a.path.find(r=>r.col===t&&r.row===s))continue;if(a.path.find(r=>i[r.col+r.row*9]===e))return!1}return!0},k={[h.NORMAL_SUDOKU]:C,[h.KINGS_MOVE]:b,[h.KNIGHTS_MOVE]:O,[h.KILLER_SUDOKU]:_},A=(l,i,e,n,o)=>{for(const t of l)if(!k[t](i,e,n,o))return!1;return!0};var K=(l=>(l[l.NOTHING=0]="NOTHING",l[l.TRY_THINKING=1]="TRY_THINKING",l[l.MISTAKE=2]="MISTAKE",l[l.EASY_NAKED_SINGLE=3]="EASY_NAKED_SINGLE",l[l.NAKED_SINGLE=4]="NAKED_SINGLE",l[l.BOARD_FINISHED=5]="BOARD_FINISHED",l))(K||{});let x=Date.now(),m=0;const D=()=>{const l=Date.now();return m++,m>=4&&l-x<5e3?(m=0,[]):(x=l,null)},v=(l,i,e)=>{const n=new Map;for(let o=0;o<9;o++){n.clear();for(let t=0;t<9;t++){const s=o+t*9;if(e[s]!==null){if(n.has(e[s]))return[n.get(e[s]),{col:o,row:t}];n.set(e[s],{col:o,row:t})}}}for(let o=0;o<9;o++){n.clear();for(let t=0;t<9;t++){const s=t+o*9;if(e[s]!==null){if(n.has(e[s]))return[n.get(e[s]),{col:t,row:o}];n.set(e[s],{col:t,row:o})}}}for(let o=0;o<9;o+=3)for(let t=0;t<9;t+=3){n.clear();for(let s=0;s<3;s++)for(let a=0;a<3;a++){const f=o+s,I=t+a,r=f+I*9;if(e[r]!==null){if(n.has(e[r]))return[n.get(e[r]),{col:f,row:I}];n.set(e[r],{col:f,row:I})}}}return null},G=(l,i,e)=>{const n=[1,2,3,4,5,6,7,8,9];for(const o of n){const t=[],s=[];for(let c=0;c<9;c++)for(let u=0;u<9;u++){const w=c+u*9;e[w]===o&&(t.push(c),s.push(u))}const a=[0,1,2,3,4,5,6,7,8].filter(c=>!t.includes(c)),f=[0,1,2,3,4,5,6,7,8].filter(c=>!s.includes(c)),I=new Map;for(let c=0;c<a.length;c++)o:for(let u=0;u<f.length;u++){const w=a[c],R=f[u],d=w+R*9;if(e[d]!==null)continue;const S=Math.floor(R/3)*3,E=Math.floor(w/3)*3,U=S+3,B=E+3;for(let M=S;M<U;M++)for(let g=E;g<B;g++){const Y=M*9+g;if(e[Y]===o)continue o}const N=`${E}x${S}`;I.has(N)?I.set(N,{count:I.get(N).count+1,col:w,row:R}):I.set(N,{count:1,col:w,row:R})}const r=[...I.entries()].find(([,c])=>c.count===1);if(r){const{col:c,row:u}=r[1];return[{col:c,row:u}]}}return null},j=(l,i,e)=>{for(let n=0;n<e.length;n++){if(e[n]!==null)continue;const o=n%9,t=Math.floor(n/9),s=[1,2,3,4,5,6,7,8,9],a=[];o:for(;s.length;){const f=s.pop();for(let w=0;w<9;w++){const R=t*9+w,d=o+w*9;if(R!==n&&e[R]===f||d!==n&&e[d]===f)continue o}const I=Math.floor(t/3)*3,r=Math.floor(o/3)*3,c=I+3,u=r+3;for(let w=I;w<c;w++)for(let R=r;R<u;R++){const d=w*9+R;if(d!==n&&e[d]===f)continue o}a.push(f)}if(a.length===1)return[{col:o,row:t}]}return null},L=(l,i,e)=>{for(let n=0;n<e.length;n++){const o=e[n];if(o===null||!A(l,i,e,o,n))return null}return[]},V={[1]:D,[2]:v,[3]:G,[4]:j,[5]:L},H=({cells:l,rules:i,meta:e})=>{const n=Object.keys(K).map(o=>parseInt(o,10)).filter(o=>!Number.isNaN(o));for(const o of n){if(o===0)continue;const t=V[o](i,e,l);if(t)return{type:o,cells:t}}return{type:0,cells:[]}};onmessage=({data:l})=>{const i=H(JSON.parse(l));postMessage(JSON.stringify(i))}})();
