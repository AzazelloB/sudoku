(function(){"use strict";const w={easy:38,normal:30,hard:23,expert:17},M=o=>{for(let t=o.length-1;t>0;t--){const e=Math.floor(Math.random()*(t+1)),n=o[t];o[t]=o[e],o[e]=n}},l=9,p=9,d=(o,t,e)=>{const n=e%l,r=Math.floor(e/l);for(let a=0;a<l;a++){const f=r*l+a,i=n+a*l;if(f!==e&&o[f]===t||i!==e&&o[i]===t)return!1}const s=Math.floor(r/3)*3,c=Math.floor(n/3)*3,u=s+3,h=c+3;for(let a=s;a<u;a++)for(let f=c;f<h;f++){const i=a*l+f;if(i!==e&&o[i]===t)return!1}return!0},m=(o,t=0)=>{if(t===o.length)return!0;const e=[1,2,3,4,5,6,7,8,9];for(;e.length;){const[n]=e.splice(Math.floor(Math.random()*e.length),1);if(d(o,n,t)&&(o[t]=n,m(o,t+1)))return!0}return o[t]=null,!1},v=o=>{for(let t=0;t<o.length;t++)if(o[t]===null)return t;return null},I=()=>{let o=0;return function t(e,n=0){if(o++,o>1e6)throw new Error("enough");if(n>1)return n;const r=v(e);if(r!==null)for(let s=1;s<=9;s++)d(e,s,r)&&(e[r]=s,n=t(e,n),e[r]=null);else n++;return n}},g=(o,t)=>{try{const e=I(),n=o.slice(),r=[...n.keys()];M(r);const s=n.length-1-w[t];for(let c=0;c<=s;){const u=r.pop(),h=n[u];n[u]=null,e(n.slice())===1?c++:(n[u]=h,r.unshift(u))}return n}catch{return g(o,t)}};onmessage=({data:{difficulty:o}})=>{const t=new Array(l*p).fill(null);m(t);const e=g(t,o),n=[];for(let r=0;r<t.length;r+=1)n.push({value:null,answer:t[r],revealed:e[r]!==null,corner:[],middle:[],col:r%l,row:Math.floor(r/l),colors:[]});postMessage(n)}})();
