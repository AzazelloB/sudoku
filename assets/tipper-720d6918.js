(function(){"use strict";var N=(t=>(t[t.NORMAL_SUDOKU=0]="NORMAL_SUDOKU",t[t.KINGS_MOVE=1]="KINGS_MOVE",t[t.KNIGHTS_MOVE=2]="KNIGHTS_MOVE",t))(N||{});const b=(t,e,n)=>{const o=n%9,l=Math.floor(n/9);for(let f=0;f<9;f++){const s=l*9+f,i=o+f*9;if(s!==n&&t[s]===e||i!==n&&t[i]===e)return!1}const r=Math.floor(l/3)*3,c=Math.floor(o/3)*3,a=r+3,I=c+3;for(let f=r;f<a;f++)for(let s=c;s<I;s++){const i=f*9+s;if(i!==n&&t[i]===e)return!1}return!0},g=(t,e,n)=>{for(let o=-1;o<=1;o++)for(let l=-1;l<=1;l++){const r=n+o*9+l;if(r!==n&&t[r]===e)return!1}return!0},O=(t,e,n)=>{const o=n%9,l=Math.floor(n/9),r=[{col:o-2,row:l-1},{col:o-2,row:l+1},{col:o-1,row:l-2},{col:o-1,row:l+2},{col:o+1,row:l-2},{col:o+1,row:l+2},{col:o+2,row:l-1},{col:o+2,row:l+1}];for(const c of r)if(c.col>=0&&c.col<9&&c.row>=0&&c.row<9){const a=c.row*9+c.col;if(t[a]===e)return!1}return!0},_={[N.NORMAL_SUDOKU]:b,[N.KINGS_MOVE]:g,[N.KNIGHTS_MOVE]:O},C=(t,e,n,o)=>{for(const l of t)if(!_[l](e,n,o))return!1;return!0};var m=(t=>(t[t.NOTHING=0]="NOTHING",t[t.TRY_THINKING=1]="TRY_THINKING",t[t.MISTAKE=2]="MISTAKE",t[t.EASY_NAKED_SINGLE=3]="EASY_NAKED_SINGLE",t[t.NAKED_SINGLE=4]="NAKED_SINGLE",t[t.BOARD_FINISHED=5]="BOARD_FINISHED",t))(m||{});let K=Date.now(),M=0;const A=()=>{const t=Date.now();return M++,M>=4&&t-K<5e3?(M=0,[]):(K=t,null)},G=(t,e)=>{const n=new Map;for(let o=0;o<9;o++){n.clear();for(let l=0;l<9;l++){const r=o+l*9;if(e[r]!==null){if(n.has(e[r]))return[n.get(e[r]),{col:o,row:l}];n.set(e[r],{col:o,row:l})}}}for(let o=0;o<9;o++){n.clear();for(let l=0;l<9;l++){const r=l+o*9;if(e[r]!==null){if(n.has(e[r]))return[n.get(e[r]),{col:l,row:o}];n.set(e[r],{col:l,row:o})}}}for(let o=0;o<9;o+=3)for(let l=0;l<9;l+=3){n.clear();for(let r=0;r<3;r++)for(let c=0;c<3;c++){const a=o+r,I=l+c,f=a+I*9;if(e[f]!==null){if(n.has(e[f]))return[n.get(e[f]),{col:a,row:I}];n.set(e[f],{col:a,row:I})}}}return null},D=(t,e)=>{const n=[1,2,3,4,5,6,7,8,9];for(const o of n){const l=[],r=[];for(let s=0;s<9;s++)for(let i=0;i<9;i++){const u=s+i*9;e[u]===o&&(l.push(s),r.push(i))}const c=[0,1,2,3,4,5,6,7,8].filter(s=>!l.includes(s)),a=[0,1,2,3,4,5,6,7,8].filter(s=>!r.includes(s)),I=new Map;for(let s=0;s<c.length;s++)o:for(let i=0;i<a.length;i++){const u=c[s],w=a[i],R=u+w*9;if(e[R]!==null)continue;const S=Math.floor(w/3)*3,h=Math.floor(u/3)*3,H=S+3,L=h+3;for(let E=S;E<H;E++)for(let x=h;x<L;x++){const U=E*9+x;if(e[U]===o)continue o}const d=`${h}x${S}`;I.has(d)?I.set(d,{count:I.get(d).count+1,col:u,row:w}):I.set(d,{count:1,col:u,row:w})}const f=[...I.entries()].find(([,s])=>s.count===1);if(f){const{col:s,row:i}=f[1];return[{col:s,row:i}]}}return null},k=(t,e)=>{for(let n=0;n<e.length;n++){if(e[n]!==null)continue;const o=n%9,l=Math.floor(n/9),r=[1,2,3,4,5,6,7,8,9],c=[];o:for(;r.length;){const a=r.pop();for(let u=0;u<9;u++){const w=l*9+u,R=o+u*9;if(w!==n&&e[w]===a||R!==n&&e[R]===a)continue o}const I=Math.floor(l/3)*3,f=Math.floor(o/3)*3,s=I+3,i=f+3;for(let u=I;u<s;u++)for(let w=f;w<i;w++){const R=u*9+w;if(R!==n&&e[R]===a)continue o}c.push(a)}if(c.length===1)return[{col:o,row:l}]}return null},V=(t,e)=>{for(let n=0;n<e.length;n++){const o=e[n];if(o===null||!C(t,e,o,n))return null}return[]},j={[1]:A,[2]:G,[3]:D,[4]:k,[5]:V},v=({cells:t,rules:e})=>{const n=Object.keys(m).map(o=>parseInt(o,10)).filter(o=>!Number.isNaN(o));for(const o of n){if(o===0)continue;const l=j[o](e,t);if(l)return{type:o,cells:l}}return{type:0,cells:[]}};onmessage=({data:{cells:t,rules:e}})=>{const n=v({cells:t,rules:e});postMessage(JSON.stringify(n))}})();
