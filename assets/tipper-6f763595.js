(function(){"use strict";var h=(e=>(e.NORMAL_SUDOKU="normal-sudoku",e.KINGS_MOVE="kings-move",e.KNIGHTS_MOVE="knights-move",e.KILLER_SUDOKU="killer-sudoku",e))(h||{});const C=(e,i,l,n)=>{const o=n%9,t=Math.floor(n/9);for(let r=0;r<9;r++){const c=t*9+r,u=o+r*9;if(c!==n&&i[c]===l||u!==n&&i[u]===l)return!1}const s=Math.floor(t/3)*3,a=Math.floor(o/3)*3,f=s+3,I=a+3;for(let r=s;r<f;r++)for(let c=a;c<I;c++){const u=r*9+c;if(u!==n&&i[u]===l)return!1}return!0},b=(e,i,l,n)=>{for(let o=-1;o<=1;o++)for(let t=-1;t<=1;t++){const s=n+o*9+t;if(s!==n&&i[s]===l)return!1}return!0},_=(e,i,l,n)=>{const o=n%9,t=Math.floor(n/9),s=[{col:o-2,row:t-1},{col:o-2,row:t+1},{col:o-1,row:t-2},{col:o-1,row:t+2},{col:o+1,row:t-2},{col:o+1,row:t+2},{col:o+2,row:t-1},{col:o+2,row:t+1}];for(const a of s)if(a.col>=0&&a.col<9&&a.row>=0&&a.row<9){const f=a.row*9+a.col;if(i[f]===l)return!1}return!0},k=(e,i,l,n)=>{const{cages:o}=e,t=n%9,s=Math.floor(n/9);for(const a of o){if(!a.path.find(r=>r.col===t&&r.row===s))continue;if(a.path.find(r=>i[r.col+r.row*9]===l))return!1}return!0},O={[h.NORMAL_SUDOKU]:C,[h.KINGS_MOVE]:b,[h.KNIGHTS_MOVE]:_,[h.KILLER_SUDOKU]:k},A=(e,i,l,n,o)=>{for(const t of e)if(!O[t](i,l,n,o))return!1;return!0};var K=(e=>(e[e.NOTHING=0]="NOTHING",e[e.TRY_THINKING=1]="TRY_THINKING",e[e.MISTAKE=2]="MISTAKE",e[e.EASY_NAKED_SINGLE=3]="EASY_NAKED_SINGLE",e[e.NAKED_SINGLE=4]="NAKED_SINGLE",e[e.BOARD_FINISHED=5]="BOARD_FINISHED",e))(K||{});let x=Date.now(),N=0;const D=()=>{const e=Date.now();return N++,N>=4&&e-x<5e3?(N=0,[]):(x=e,null)},v=(e,i,l)=>{const n=new Map;for(let o=0;o<9;o++){n.clear();for(let t=0;t<9;t++){const s=o+t*9;if(l[s]!==null){if(n.has(l[s]))return[n.get(l[s]),{col:o,row:t}];n.set(l[s],{col:o,row:t})}}}for(let o=0;o<9;o++){n.clear();for(let t=0;t<9;t++){const s=t+o*9;if(l[s]!==null){if(n.has(l[s]))return[n.get(l[s]),{col:t,row:o}];n.set(l[s],{col:t,row:o})}}}for(let o=0;o<9;o+=3)for(let t=0;t<9;t+=3){n.clear();for(let s=0;s<3;s++)for(let a=0;a<3;a++){const f=o+s,I=t+a,r=f+I*9;if(l[r]!==null){if(n.has(l[r]))return[n.get(l[r]),{col:f,row:I}];n.set(l[r],{col:f,row:I})}}}return null},G=(e,i,l)=>{const n=[1,2,3,4,5,6,7,8,9];for(const o of n){const t=[],s=[];for(let c=0;c<9;c++)for(let u=0;u<9;u++){const w=c+u*9;l[w]===o&&(t.push(c),s.push(u))}const a=[0,1,2,3,4,5,6,7,8].filter(c=>!t.includes(c)),f=[0,1,2,3,4,5,6,7,8].filter(c=>!s.includes(c)),I=new Map;for(let c=0;c<a.length;c++)o:for(let u=0;u<f.length;u++){const w=a[c],R=f[u],d=w+R*9;if(l[d]!==null)continue;const S=Math.floor(R/3)*3,E=Math.floor(w/3)*3,U=S+3,B=E+3;for(let M=S;M<U;M++)for(let g=E;g<B;g++){const Y=M*9+g;if(l[Y]===o)continue o}const m=`${E}x${S}`;I.has(m)?I.set(m,{count:I.get(m).count+1,col:w,row:R}):I.set(m,{count:1,col:w,row:R})}const r=[...I.entries()].find(([,c])=>c.count===1);if(r){const{col:c,row:u}=r[1];return[{col:c,row:u}]}}return null},j=(e,i,l)=>{for(let n=0;n<l.length;n++){if(l[n]!==null)continue;const o=n%9,t=Math.floor(n/9),s=[1,2,3,4,5,6,7,8,9],a=[];o:for(;s.length;){const f=s.pop();for(let w=0;w<9;w++){const R=t*9+w,d=o+w*9;if(R!==n&&l[R]===f||d!==n&&l[d]===f)continue o}const I=Math.floor(t/3)*3,r=Math.floor(o/3)*3,c=I+3,u=r+3;for(let w=I;w<c;w++)for(let R=r;R<u;R++){const d=w*9+R;if(d!==n&&l[d]===f)continue o}a.push(f)}if(a.length===1)return[{col:o,row:t}]}return null},L=(e,i,l)=>{for(let n=0;n<l.length;n++){const o=l[n];if(o===null||!A(e,i,l,o,n))return null}return[]},V={[1]:D,[2]:v,[3]:G,[4]:j,[5]:L},H=({cells:e,rules:i,meta:l})=>{const n=Object.keys(K).map(o=>parseInt(o,10)).filter(o=>!Number.isNaN(o));for(const o of n){if(o===0)continue;const t=V[o](i,l,e);if(t)return{type:o,cells:t}}return{type:0,cells:[]}};onmessage=({data:e})=>{const i=H(e);postMessage(JSON.stringify(i))}})();
